<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>HVAC AI Receptionist - Voice Demo</title>
<style>
*{box-sizing:border-box;margin:0;padding:0}
body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;background:#0f172a;color:#e2e8f0;min-height:100vh;display:flex;align-items:center;justify-content:center}
.container{max-width:520px;width:100%;padding:40px 20px;text-align:center}
h1{font-size:1.5rem;margin-bottom:8px;color:#38bdf8}
.subtitle{color:#94a3b8;margin-bottom:30px;font-size:0.9rem}
.chat-box{background:#1e293b;border-radius:16px;padding:20px;min-height:320px;max-height:420px;overflow-y:auto;margin-bottom:20px;text-align:left}
.msg{margin:10px 0;padding:10px 14px;border-radius:12px;max-width:85%;font-size:0.95rem;line-height:1.4}
.msg.user{background:#3b82f6;color:white;margin-left:auto}
.msg.ai{background:#334155;color:#e2e8f0}
.msg.system{background:#7c3aed22;color:#a78bfa;font-size:0.8rem;text-align:center;max-width:100%}
.msg .meta{font-size:0.7rem;color:#64748b;margin-top:4px}
.controls{display:flex;gap:10px;margin-bottom:15px}
.controls input{flex:1;padding:12px 16px;border-radius:12px;border:2px solid #334155;background:#1e293b;color:#e2e8f0;font-size:1rem}
.controls input:focus{outline:none;border-color:#3b82f6}
.btn{padding:12px 20px;border-radius:12px;border:none;font-size:1rem;cursor:pointer;font-weight:600;transition:all 0.2s}
.btn-send{background:#3b82f6;color:white}
.btn-send:hover{background:#2563eb}
.btn-mic{background:#10b981;color:white;width:50px}
.btn-mic.active{background:#ef4444;animation:pulse 1.5s infinite}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:0.7}}
.status{color:#64748b;font-size:0.8rem;margin-top:10px}
.badge{display:inline-block;padding:2px 8px;border-radius:8px;font-size:0.7rem;font-weight:600}
.badge.emergency{background:#ef444433;color:#f87171}
.badge.mock{background:#f59e0b33;color:#fbbf24}
.scenarios{margin-top:20px;text-align:left}
.scenarios h3{color:#94a3b8;font-size:0.8rem;margin-bottom:8px}
.scenario-btn{display:block;width:100%;text-align:left;padding:8px 12px;margin:4px 0;background:#1e293b;border:1px solid #334155;color:#94a3b8;border-radius:8px;cursor:pointer;font-size:0.85rem}
.scenario-btn:hover{border-color:#3b82f6;color:#e2e8f0}
</style>
</head>
<body>
<div class="container">
<h1>üîß HVAC AI Receptionist</h1>
<p class="subtitle">Speak or type your HVAC question <span class="badge mock">DEMO</span></p>
<div class="chat-box" id="chatBox">
<div class="msg ai">Hello! Thank you for calling. How can I help you with your heating or cooling needs today?</div>
</div>
<div class="controls">
<input type="text" id="msgInput" placeholder="Type or click mic..." onkeydown="if(event.key==='Enter')sendMsg()">
<button class="btn btn-mic" id="micBtn" onclick="toggleMic()">üé§</button>
<button class="btn btn-send" onclick="sendMsg()">Send</button>
</div>
<div class="status" id="status">Ready</div>
<div class="scenarios">
<h3>Try these scenarios:</h3>
<button class="scenario-btn" onclick="tryScenario(this)">My furnace stopped and it's 45 degrees. I have an elderly parent.</button>
<button class="scenario-btn" onclick="tryScenario(this)">I smell gas in my basement!</button>
<button class="scenario-btn" onclick="tryScenario(this)">I'd like to schedule a maintenance tune-up.</button>
<button class="scenario-btn" onclick="tryScenario(this)">My AC is broken and it's 98 degrees with a baby at home.</button>
<button class="scenario-btn" onclick="tryScenario(this)">How much does a repair visit cost?</button>
</div>
</div>
<script>
const chatBox=document.getElementById('chatBox');
const input=document.getElementById('msgInput');
const micBtn=document.getElementById('micBtn');
const status=document.getElementById('status');
let recognition=null,isListening=false,sessionId=null;

if('webkitSpeechRecognition' in window||'SpeechRecognition' in window){
  const SR=window.SpeechRecognition||window.webkitSpeechRecognition;
  recognition=new SR();recognition.continuous=false;recognition.interimResults=true;recognition.lang='en-US';
  recognition.onresult=(e)=>{const t=Array.from(e.results).map(r=>r[0].transcript).join('');input.value=t;if(e.results[0].isFinal){stopMic();sendMsg();}};
  recognition.onerror=(e)=>{status.textContent='Mic error: '+e.error;stopMic();};
  recognition.onend=()=>{if(isListening)stopMic();};
}
function toggleMic(){isListening?stopMic():startMic();}
function startMic(){if(!recognition){status.textContent='Speech not supported';return;}recognition.start();isListening=true;micBtn.classList.add('active');micBtn.textContent='‚èπ';status.textContent='Listening...';}
function stopMic(){if(recognition)try{recognition.stop();}catch(e){}isListening=false;micBtn.classList.remove('active');micBtn.textContent='üé§';status.textContent='Ready';}
function tryScenario(btn){input.value=btn.textContent;sendMsg();}

async function sendMsg(){
  const text=input.value.trim();if(!text)return;
  addMsg(text,'user');input.value='';status.textContent='Thinking...';
  try{
    const resp=await fetch('/api/chat',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({text,session_id:sessionId})});
    const data=await resp.json();sessionId=data.session_id;
    let meta=`${data.latency_ms}ms ‚Ä¢ ${data.llm_method}`;
    if(data.emergency?.is_emergency)meta+=' ‚Ä¢ <span class="badge emergency">'+data.emergency.priority+'</span>';
    addMsg(data.response,'ai',meta);
    if('speechSynthesis' in window){const u=new SpeechSynthesisUtterance(data.response);u.rate=1.0;speechSynthesis.speak(u);}
    status.textContent=`Ready ‚Ä¢ Session: ${sessionId.slice(0,8)}...`;
  }catch(e){addMsg('Connection error.','system');status.textContent='Error: '+e.message;}
}
function addMsg(text,type,meta=''){const d=document.createElement('div');d.className='msg '+type;d.innerHTML=text+(meta?'<div class="meta">'+meta+'</div>':'');chatBox.appendChild(d);chatBox.scrollTop=chatBox.scrollHeight;}
</script>
</body>
</html>
