<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>HVAC AI Receptionist — Dashboard</title>
<style>
*{box-sizing:border-box;margin:0;padding:0}
body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif;background:#f1f5f9;color:#1e293b;min-height:100vh}

/* Header */
.header{background:#fff;border-bottom:1px solid #e2e8f0;padding:12px 24px;display:flex;align-items:center;justify-content:space-between;box-shadow:0 1px 3px rgba(0,0,0,.04)}
.header h1{font-size:18px;font-weight:700;color:#0f172a}
.header .sub{font-size:12px;color:#94a3b8}
.header .status{display:flex;align-items:center;gap:6px;font-size:12px;font-weight:500;color:#16a34a}
.header .dot{width:8px;height:8px;border-radius:50%;background:#22c55e;animation:pulse 2s infinite}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.4}}

/* Tabs */
.tabs{background:#fff;border-bottom:1px solid #e2e8f0;padding:0 24px;display:flex;gap:0}
.tab{padding:12px 16px;font-size:14px;font-weight:500;color:#94a3b8;border:none;background:none;cursor:pointer;border-bottom:2px solid transparent}
.tab.active{color:#0f172a;border-bottom-color:#0f172a}
.tab:hover{color:#475569}

/* Main */
.main{max-width:1200px;margin:0 auto;padding:24px}

/* Stats Grid */
.stats{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:16px;margin-bottom:24px}
.stat{background:#fff;border-radius:12px;border:1px solid #e2e8f0;padding:16px}
.stat-label{font-size:11px;font-weight:600;text-transform:uppercase;letter-spacing:.5px;color:#94a3b8}
.stat-value{font-size:28px;font-weight:700;color:#0f172a;margin:4px 0}
.stat-sub{font-size:12px;color:#94a3b8}
.stat.emergency .stat-value{color:#dc2626}
.stat.success .stat-value{color:#16a34a}

/* Cards */
.card{background:#fff;border-radius:12px;border:1px solid #e2e8f0;overflow:hidden;margin-bottom:16px}
.card-header{padding:12px 16px;border-bottom:1px solid #f1f5f9;display:flex;align-items:center;justify-content:space-between}
.card-header h2{font-size:14px;font-weight:600;color:#0f172a}
.card-header .badge{font-size:11px;font-weight:600;padding:2px 8px;border-radius:12px}

/* Call Rows */
.call-row{display:flex;align-items:center;gap:12px;padding:12px 16px;border-bottom:1px solid #f8fafc;cursor:pointer;transition:background .15s}
.call-row:hover{background:#f8fafc}
.call-row:last-child{border-bottom:none}
.call-time{font-size:12px;color:#94a3b8;font-family:monospace;width:60px;flex-shrink:0}
.call-priority{font-size:11px;font-weight:600;padding:2px 8px;border-radius:12px;color:#fff;flex-shrink:0}
.call-priority.CRITICAL{background:#dc2626}
.call-priority.HIGH{background:#f59e0b}
.call-priority.MEDIUM{background:#3b82f6}
.call-priority.LOW{background:#10b981}
.call-name{font-size:13px;font-weight:500;color:#1e293b;width:120px;flex-shrink:0;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.call-summary{font-size:13px;color:#64748b;flex:1;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.call-badge{font-size:11px;padding:2px 8px;border-radius:12px;font-weight:500;flex-shrink:0}
.call-badge.ai{background:#dcfce7;color:#166534}
.call-badge.escalated{background:#ffedd5;color:#9a3412}

/* Transcript */
.transcript{padding:12px 16px;background:#f8fafc;border-top:1px solid #e2e8f0;font-size:13px;color:#475569;line-height:1.6;display:none}
.transcript.open{display:block}
.transcript .meta{font-size:11px;color:#94a3b8;margin-bottom:8px;display:flex;gap:16px}

/* Grid layout */
.grid-2{display:grid;grid-template-columns:2fr 1fr;gap:16px}
@media(max-width:768px){.grid-2{grid-template-columns:1fr}}

/* Tech cards */
.tech{display:flex;align-items:center;gap:12px;padding:12px 16px;border-bottom:1px solid #f1f5f9}
.tech:last-child{border-bottom:none}
.tech-avatar{width:36px;height:36px;border-radius:50%;background:#1e293b;color:#fff;display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:700;flex-shrink:0}
.tech-info{flex:1}
.tech-name{font-size:13px;font-weight:600;color:#1e293b}
.tech-job{font-size:11px;color:#94a3b8}
.tech-status{font-size:11px;font-weight:500;padding:3px 8px;border-radius:12px}
.tech-status.available{background:#dcfce7;color:#166534}
.tech-status.on-job{background:#fee2e2;color:#991b1b}
.tech-status.driving{background:#fef3c7;color:#92400e}

/* Emergency alerts */
.alert{padding:12px 16px;border-left:4px solid #dc2626;background:#fef2f2;margin-bottom:8px;border-radius:0 8px 8px 0}
.alert-title{font-size:13px;font-weight:600;color:#991b1b}
.alert-detail{font-size:12px;color:#b91c1c;margin-top:4px}
.alert-time{font-size:11px;color:#f87171;margin-top:2px}

/* Health indicators */
.health-row{display:flex;align-items:center;justify-content:space-between;padding:10px 16px;border-bottom:1px solid #f1f5f9}
.health-row:last-child{border-bottom:none}
.health-name{font-size:13px;color:#475569}
.health-status{font-size:12px;font-weight:500;padding:2px 10px;border-radius:12px}
.health-status.ok{background:#dcfce7;color:#166534}
.health-status.warn{background:#fef3c7;color:#92400e}
.health-status.error{background:#fee2e2;color:#991b1b}

/* Inventory */
.inv-row{display:flex;align-items:center;justify-content:space-between;padding:10px 16px;border-bottom:1px solid #f1f5f9}
.inv-row:last-child{border-bottom:none}
.inv-name{font-size:13px;color:#1e293b;font-weight:500}
.inv-sku{font-size:11px;color:#94a3b8;font-family:monospace}
.inv-stock{font-size:14px;font-weight:700}
.inv-stock.low{color:#f59e0b}
.inv-stock.critical{color:#dc2626}
.inv-stock.ok{color:#16a34a}
.inv-epa{font-size:10px;font-weight:700;color:#dc2626;background:#fee2e2;padding:1px 6px;border-radius:4px;margin-left:6px}

/* Loading */
.loading{text-align:center;padding:40px;color:#94a3b8;font-size:14px}
.spinner{display:inline-block;width:24px;height:24px;border:3px solid #e2e8f0;border-top-color:#3b82f6;border-radius:50%;animation:spin .8s linear infinite;margin-bottom:8px}
@keyframes spin{to{transform:rotate(360deg)}}

/* Footer */
.footer{border-top:1px solid #e2e8f0;background:#fff;padding:12px 24px;margin-top:32px;display:flex;justify-content:space-between;font-size:11px;color:#94a3b8}
</style>
</head>
<body>

<div class="header">
  <div>
    <h1>Comfort Air HVAC</h1>
    <div class="sub">AI Receptionist Dashboard</div>
  </div>
  <div style="display:flex;align-items:center;gap:16px">
    <div class="status"><div class="dot"></div> System Online</div>
    <div class="sub" id="clock"></div>
  </div>
</div>

<div class="tabs">
  <button class="tab active" data-tab="overview">Overview</button>
  <button class="tab" data-tab="calls">Calls</button>
  <button class="tab" data-tab="health">System Health</button>
</div>

<div class="main">
  <!-- OVERVIEW TAB -->
  <div id="tab-overview" class="tab-content">
    <div class="stats" id="stats-grid">
      <div class="stat"><div class="stat-label">Calls Today</div><div class="stat-value" id="stat-calls">-</div><div class="stat-sub" id="stat-calls-sub"></div></div>
      <div class="stat success"><div class="stat-label">AI Handled</div><div class="stat-value" id="stat-ai">-</div><div class="stat-sub">100% automation</div></div>
      <div class="stat emergency"><div class="stat-label">Emergencies</div><div class="stat-value" id="stat-emergencies">-</div><div class="stat-sub" id="stat-emerg-sub"></div></div>
      <div class="stat"><div class="stat-label">Active Calls</div><div class="stat-value" id="stat-active">-</div><div class="stat-sub">via Telnyx</div></div>
    </div>

    <div class="grid-2">
      <div>
        <!-- Recent Calls -->
        <div class="card">
          <div class="card-header">
            <h2>Recent Calls</h2>
            <span class="badge" style="background:#dbeafe;color:#1d4ed8" id="calls-count"></span>
          </div>
          <div id="recent-calls"><div class="loading"><div class="spinner"></div><br>Loading calls...</div></div>
        </div>

        <!-- Emergency Alerts -->
        <div class="card">
          <div class="card-header">
            <h2>Emergency Alerts</h2>
            <span class="badge" style="background:#fee2e2;color:#991b1b" id="alert-count">0</span>
          </div>
          <div id="emergency-alerts" style="padding:8px"><div class="loading">No active emergencies</div></div>
        </div>
      </div>

      <div>
        <!-- Active Telnyx Calls -->
        <div class="card">
          <div class="card-header"><h2>Active Phone Calls</h2></div>
          <div id="active-calls"><div class="loading">Checking...</div></div>
        </div>

        <!-- System Health Quick -->
        <div class="card">
          <div class="card-header"><h2>System Health</h2></div>
          <div id="health-quick"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- CALLS TAB -->
  <div id="tab-calls" class="tab-content" style="display:none">
    <div class="card">
      <div class="card-header">
        <h2>All Calls — Today</h2>
        <span class="badge" style="background:#dbeafe;color:#1d4ed8" id="all-calls-count"></span>
      </div>
      <div id="all-calls"><div class="loading"><div class="spinner"></div><br>Loading...</div></div>
    </div>

    <!-- Test Chat -->
    <div class="card" style="margin-top:16px">
      <div class="card-header"><h2>Test AI Chat</h2></div>
      <div style="padding:16px">
        <div id="test-chat-log" style="min-height:100px;max-height:300px;overflow-y:auto;background:#f8fafc;border-radius:8px;padding:12px;margin-bottom:12px;font-size:13px"></div>
        <div style="display:flex;gap:8px">
          <input id="test-input" type="text" placeholder="Type a message to test..." style="flex:1;padding:10px 12px;border:1px solid #e2e8f0;border-radius:8px;font-size:14px" />
          <button onclick="testChat()" style="padding:10px 20px;background:#1e293b;color:#fff;border:none;border-radius:8px;cursor:pointer;font-weight:600">Send</button>
        </div>
      </div>
    </div>
  </div>

  <!-- HEALTH TAB -->
  <div id="tab-health" class="tab-content" style="display:none">
    <div class="stats">
      <div class="stat"><div class="stat-label">API Server</div><div class="stat-value" id="h-api" style="font-size:16px">Checking...</div></div>
      <div class="stat"><div class="stat-label">Voice Pipeline</div><div class="stat-value" id="h-voice" style="font-size:16px">Checking...</div></div>
      <div class="stat"><div class="stat-label">Telephony</div><div class="stat-value" id="h-telnyx" style="font-size:16px">Checking...</div></div>
    </div>

    <div class="card">
      <div class="card-header"><h2>Service Details</h2></div>
      <div id="health-details"></div>
    </div>

    <div class="card" style="margin-top:16px">
      <div class="card-header"><h2>Voice Pipeline Components</h2></div>
      <div id="voice-details"></div>
    </div>
  </div>
</div>

<div class="footer">
  <span>HVAC AI Receptionist v5.0</span>
  <span>5-layer safety active &bull; NO human fallback &bull; All systems monitored</span>
</div>

<script>
// ─── State ───
let calls = [];
let emergencies = [];
let sessionId = 'dashboard_' + Math.random().toString(36).slice(2, 8);

// ─── Clock ───
function updateClock() {
  const now = new Date();
  document.getElementById('clock').textContent =
    now.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' }) +
    ' \u00b7 ' + now.toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit' });
}
updateClock();
setInterval(updateClock, 60000);

// ─── Tabs ───
document.querySelectorAll('.tab').forEach(tab => {
  tab.addEventListener('click', () => {
    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
    document.querySelectorAll('.tab-content').forEach(c => c.style.display = 'none');
    tab.classList.add('active');
    document.getElementById('tab-' + tab.dataset.tab).style.display = 'block';
  });
});

// ─── API Helpers ───
async function api(url, opts) {
  try {
    const r = await fetch(url, opts);
    return { ok: r.ok, status: r.status, data: r.ok ? await r.json() : null };
  } catch (e) {
    return { ok: false, status: 0, error: e.message };
  }
}

// ─── Render Call Row ───
function renderCallRow(call, container) {
  const row = document.createElement('div');
  const priority = call.emergency?.priority || call.priority || 'LOW';
  const isEmerg = call.emergency?.is_emergency || false;
  const name = call.from_number || call.name || 'Unknown';
  const summary = call.response || call.summary || '';
  const time = call.time || new Date().toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit' });
  const aiHandled = call.aiHandled !== false;

  row.innerHTML = `
    <div class="call-row" onclick="this.nextElementSibling.classList.toggle('open')">
      <span class="call-time">${time}</span>
      <span class="call-priority ${priority}">${priority}</span>
      <span class="call-name">${name}</span>
      <span class="call-summary">${summary.substring(0, 120)}</span>
      <span class="call-badge ${aiHandled ? 'ai' : 'escalated'}">${aiHandled ? 'AI' : 'Escalated'}</span>
    </div>
    <div class="transcript">
      <div class="meta">
        <span>From: ${call.from_number || 'N/A'}</span>
        <span>Duration: ${call.duration || 'N/A'}</span>
        ${isEmerg ? '<span style="color:#dc2626;font-weight:600">EMERGENCY</span>' : ''}
      </div>
      <p>${call.transcript || summary}</p>
    </div>
  `;
  container.appendChild(row);
}

// ─── Load Health ───
async function loadHealth() {
  // Main API health
  const h1 = await api('/health');
  const apiOk = h1.ok;
  document.getElementById('h-api').textContent = apiOk ? 'Online' : 'Offline';
  document.getElementById('h-api').style.color = apiOk ? '#16a34a' : '#dc2626';

  // Voice pipeline health
  const h2 = await api('/api/voice/health');
  const voiceOk = h2.ok;
  document.getElementById('h-voice').textContent = voiceOk ? 'Operational' : 'Unavailable';
  document.getElementById('h-voice').style.color = voiceOk ? '#16a34a' : '#f59e0b';

  // Telnyx health
  const h3 = await api('/api/telnyx/active-calls');
  const telnyxOk = h3.ok;
  document.getElementById('h-telnyx').textContent = telnyxOk ? 'Ready' : 'Unavailable';
  document.getElementById('h-telnyx').style.color = telnyxOk ? '#16a34a' : '#f59e0b';

  // Health details
  const details = document.getElementById('health-details');
  const services = [
    { name: 'FastAPI Server', status: apiOk ? 'ok' : 'error', detail: apiOk ? 'Responding normally' : 'Not responding' },
    { name: 'Voice Pipeline (AssemblyAI STT)', status: voiceOk ? 'ok' : 'warn', detail: voiceOk ? 'Ready' : 'API key needed' },
    { name: 'Voice Pipeline (Inworld TTS)', status: voiceOk ? 'ok' : 'warn', detail: voiceOk ? 'Ready' : 'API key needed' },
    { name: 'Telephony (Telnyx)', status: telnyxOk ? 'ok' : 'warn', detail: telnyxOk ? 'Accepting calls' : 'API key needed' },
    { name: 'Database (PostgreSQL)', status: 'warn', detail: 'Using in-memory (mock mode)' },
  ];
  details.innerHTML = services.map(s => `
    <div class="health-row">
      <span class="health-name">${s.name}</span>
      <span class="health-status ${s.status}">${s.detail}</span>
    </div>
  `).join('');

  // Voice component details
  const vd = document.getElementById('voice-details');
  if (h2.ok && h2.data) {
    const d = h2.data;
    const components = d.components || {};
    vd.innerHTML = Object.entries(components).map(([k, v]) => `
      <div class="health-row">
        <span class="health-name">${k}</span>
        <span class="health-status ${v.status === 'operational' || v.status === 'ready' ? 'ok' : 'warn'}">${v.status || v}</span>
      </div>
    `).join('');
  } else {
    vd.innerHTML = '<div class="loading">Voice pipeline not available</div>';
  }

  // Quick health for overview tab
  const hq = document.getElementById('health-quick');
  hq.innerHTML = [
    { n: 'API', ok: apiOk },
    { n: 'Voice', ok: voiceOk },
    { n: 'Phone', ok: telnyxOk },
  ].map(s => `
    <div class="health-row">
      <span class="health-name">${s.n}</span>
      <span class="health-status ${s.ok ? 'ok' : 'warn'}">${s.ok ? 'Online' : 'Check'}</span>
    </div>
  `).join('');
}

// ─── Load Active Calls (Telnyx) ───
async function loadActiveCalls() {
  const r = await api('/api/telnyx/active-calls');
  const container = document.getElementById('active-calls');
  if (r.ok && r.data) {
    const activeCalls = r.data.active_calls || [];
    document.getElementById('stat-active').textContent = activeCalls.length;
    if (activeCalls.length === 0) {
      container.innerHTML = '<div class="loading">No active calls</div>';
    } else {
      container.innerHTML = '';
      activeCalls.forEach(c => {
        container.innerHTML += `
          <div class="tech">
            <div class="tech-avatar">C</div>
            <div class="tech-info">
              <div class="tech-name">${c.from_number || 'Unknown'}</div>
              <div class="tech-job">${c.turns || 0} turns &bull; ${c.is_emergency ? 'EMERGENCY' : 'Normal'}</div>
            </div>
            <span class="tech-status on-job">Live</span>
          </div>
        `;
      });
    }
  } else {
    container.innerHTML = '<div class="loading">Telephony offline</div>';
    document.getElementById('stat-active').textContent = '0';
  }
}

// ─── Test Chat ───
async function testChat() {
  const input = document.getElementById('test-input');
  const log = document.getElementById('test-chat-log');
  const text = input.value.trim();
  if (!text) return;

  log.innerHTML += `<div style="margin-bottom:8px"><strong style="color:#3b82f6">You:</strong> ${text}</div>`;
  input.value = '';
  log.scrollTop = log.scrollHeight;

  const r = await api('/api/chat', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ text, session_id: sessionId })
  });

  if (r.ok && r.data) {
    const d = r.data;
    sessionId = d.session_id;
    const meta = `${d.latency_ms}ms | ${d.llm_method || 'unknown'}`;
    const emergClass = d.emergency?.is_emergency ? ' style="color:#dc2626;font-weight:600"' : '';
    log.innerHTML += `<div style="margin-bottom:8px"${emergClass}><strong style="color:#10b981">AI:</strong> ${d.response} <span style="color:#94a3b8;font-size:11px">(${meta})</span></div>`;

    // Track call
    calls.push({
      time: new Date().toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit' }),
      name: 'Dashboard Test',
      from_number: 'Dashboard',
      response: d.response.substring(0, 100),
      summary: d.response.substring(0, 100),
      transcript: d.response,
      emergency: d.emergency,
      priority: d.emergency?.is_emergency ? d.emergency.priority : 'LOW',
      aiHandled: true,
      duration: d.latency_ms + 'ms'
    });

    if (d.emergency?.is_emergency) {
      emergencies.push({
        text: text,
        response: d.response,
        priority: d.emergency.priority,
        type: d.emergency.emergency_type,
        time: new Date().toLocaleTimeString()
      });
    }

    updateCallsDisplay();
  } else {
    log.innerHTML += `<div style="margin-bottom:8px;color:#dc2626"><strong>Error:</strong> Could not reach AI</div>`;
  }
  log.scrollTop = log.scrollHeight;
}

document.getElementById('test-input').addEventListener('keydown', e => {
  if (e.key === 'Enter') testChat();
});

// ─── Update Calls Display ───
function updateCallsDisplay() {
  // Stats
  document.getElementById('stat-calls').textContent = calls.length;
  document.getElementById('stat-calls-sub').textContent = '0 missed';
  document.getElementById('stat-ai').textContent = calls.filter(c => c.aiHandled).length + '/' + calls.length;
  document.getElementById('stat-emergencies').textContent = emergencies.length;
  document.getElementById('stat-emerg-sub').textContent = emergencies.length > 0 ? 'All handled by AI' : 'None detected';

  // Recent calls
  const recent = document.getElementById('recent-calls');
  const allCalls = document.getElementById('all-calls');
  recent.innerHTML = '';
  allCalls.innerHTML = '';

  if (calls.length === 0) {
    recent.innerHTML = '<div class="loading">No calls yet. Use Test Chat to simulate calls.</div>';
    allCalls.innerHTML = '<div class="loading">No calls yet.</div>';
  } else {
    const sorted = [...calls].reverse();
    sorted.slice(0, 5).forEach(c => renderCallRow(c, recent));
    sorted.forEach(c => renderCallRow(c, allCalls));
  }

  document.getElementById('calls-count').textContent = calls.length + ' calls';
  document.getElementById('all-calls-count').textContent = calls.length + ' calls';

  // Emergency alerts
  const alertsDiv = document.getElementById('emergency-alerts');
  document.getElementById('alert-count').textContent = emergencies.length;
  if (emergencies.length === 0) {
    alertsDiv.innerHTML = '<div class="loading">No active emergencies</div>';
  } else {
    alertsDiv.innerHTML = '';
    emergencies.forEach(e => {
      alertsDiv.innerHTML += `
        <div class="alert">
          <div class="alert-title">${e.priority} — ${e.type || 'Emergency'}</div>
          <div class="alert-detail">${e.response.substring(0, 150)}...</div>
          <div class="alert-time">${e.time}</div>
        </div>
      `;
    });
  }
}

// ─── Demo Data: Run sample scenarios ───
async function loadDemoData() {
  const scenarios = [
    { text: 'I smell gas near the furnace, help!', name: 'Sarah Mitchell', from: '+1 (214) 555-0147' },
    { text: 'My furnace stopped working and its 44 degrees inside. I have an elderly mother here.', name: 'James Cooper', from: '+1 (972) 555-0283' },
    { text: 'I want to schedule an annual AC tune-up please', name: 'Linda Torres', from: '+1 (469) 555-0391' },
    { text: 'My AC is blowing warm air, can someone come look at it today?', name: 'Robert Chang', from: '+1 (817) 555-0172' },
    { text: 'How much does duct cleaning cost?', name: 'Maria Gonzalez', from: '+1 (214) 555-0445' },
  ];

  for (const s of scenarios) {
    const r = await api('/api/chat', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ text: s.text, session_id: 'demo_' + Math.random().toString(36).slice(2, 8) })
    });

    if (r.ok && r.data) {
      calls.push({
        time: new Date().toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit' }),
        name: s.name,
        from_number: s.from,
        response: r.data.response.substring(0, 120),
        summary: r.data.response.substring(0, 120),
        transcript: r.data.response,
        emergency: r.data.emergency,
        priority: r.data.emergency?.is_emergency ? (r.data.emergency.priority || 'HIGH') : 'LOW',
        aiHandled: true,
        duration: r.data.latency_ms + 'ms'
      });

      if (r.data.emergency?.is_emergency) {
        emergencies.push({
          text: s.text,
          response: r.data.response,
          priority: r.data.emergency.priority || 'HIGH',
          type: r.data.emergency.emergency_type,
          time: new Date().toLocaleTimeString()
        });
      }
    }
  }
  updateCallsDisplay();
}

// ─── Init ───
async function init() {
  updateCallsDisplay();
  await Promise.all([loadHealth(), loadActiveCalls()]);
  await loadDemoData();
}

init();
// Refresh health + active calls every 30s
setInterval(() => { loadHealth(); loadActiveCalls(); }, 30000);
</script>
</body>
</html>
